import{A as u,B as p,C as U,D as h,E as b,G as L,H as x,I as w,J as C,K as D,L as P,M as A,N as v,O as T,P as k,Q as S,R as f,S as F,T as $,U as E,V as q,W as j,X as B,Y as R}from"./BHZ-CMYt.js";const M=()=>{let l={};l.auth=(e={})=>{const a=u({busy:!1,ready:!1,user:null,error:null,init(){if(a.auth.ready)return;const t=f();F(t,s=>{s&&(a.auth.ready=!0,s.displayName=s.displayName||s.email,s.photoURL=s.photoURL||`https://api.dicebear.com/9.x/big-smile/svg?seed=${btoa(s.email)}`,a.auth.user=s)})},async logout(){a.auth.busy=!0;try{const t=f();await $(t),a.auth.user=null}catch(t){a.auth.error=t.message}a.auth.busy=!1}});return a.init(),a},l.authCreate=(e={})=>{const a=u({busy:!1,data:{email:"",password:""},error:null,async submit(){a.authCreate.error=null,a.authCreate.busy=!0;try{const t=f(),s=await E(t,a.authCreate.data.email,a.authCreate.data.password);a.authCreate.data.email="",a.authCreate.data.password=""}catch(t){a.authCreate.error=t.message}a.authCreate.busy=!1}});return a},l.authLogin=(e={})=>{const a=u({busy:!1,data:{email:"",password:""},error:null,async submit(){a.authLogin.error=null,a.authLogin.busy=!0;try{const t=f(),s=await q(t,a.authLogin.data.email,a.authLogin.data.password);a.authLogin.data.email="",a.authLogin.data.password=""}catch(t){a.authLogin.error=t.message}a.authLogin.busy=!1}});return a},l.userList=(e={})=>{const a=u({busy:!1,params:{perPage:50,nextPage:null},error:null,async submit(){a.userList.busy=!0;const s=await f().listUsers(a.userList.perPage,a.userList.nextPage);console.log(s),a.userList.busy=!1}});return a};const i=async e=>{const a=await j(e);return{url:await B(e),name:a.name,mime:a.contentType,size:a.size}};return l.storageUpload=(e={})=>{e={onSuccess:t=>null,...e};const a=u({busy:!1,lastUploads:[],async browse(){Object.assign(document.createElement("input"),{type:"file",onchange(t){t.target.files[0]&&a.submit(t.target.files[0])}}).click()},submit(t){return new Promise((s,r)=>{a.busy=!0;let n=new FileReader;n.readAsDataURL(t),n.onload=async o=>{try{let c=btoa(o.target.result);const d=p(),y=await U(h(d,t.name),t),m=await i(y.ref);e.onSuccess(m),a.lastUploads.push(m),s(m)}catch(c){r(c)}a.busy=!1}})},...e});return a},l.storageList=(e={})=>{const a=u({busy:!1,params:{maxResults:50},pages:0,data:[],async submit(t={}){if(t={firstPage:!1,...t},!t.firstPage&&a.storageList.pages>0&&!a.storageList.params.pageToken)return;a.storageList.busy=!0;const s=p(),r=h(s);t.firstPage&&(a.storageList.pages=0,a.storageList.params.pageToken=null,a.storageList.data=[]);const n=await R(r,a.storageList.params);await Promise.all(n.items.map(async o=>{a.storageList.data.push(await i(o))})),n.nextPageToken&&a.storageList.pages++,a.storageList.params.pageToken=n.nextPageToken||!1,a.storageList.busy=!1},async loadMore(){if(!a.storageList.nextPageToken)return;const t=p(),s=h(t);a.storageList.busy=!0;const r=await R(s,{...a.storageList.params,pageToken:a.storageList.nextPageToken});await Promise.all(r.items.map(async n=>{a.storageList.data.push(await i(n))})),a.storageList.nextPageToken=r.nextPageToken||!1,a.storageList.busy=!1}});return a},l.firestoreSave=(e={})=>{e={collection:null,data:{},...e};const a=u({busy:!1,...e,error:null,submit(){return new Promise(async(t,s)=>{a.busy=!0;try{const r=b(),n=L(r,e.collection);if(a.data.id){const o=await x(r,e.collection,a.data.id);a.data.updatedAt=w().format();const c=await C(o,a.data);t(c)}else{a.data.createdAt=a.data.updatedAt=w().format();const o=await D(n,a.data);a.data.id=o.id,t(o),a.submit()}}catch(r){s(a.error=r.message)}a.busy=!1})},async dataClear(){for(let t in a.data){if(Array.isArray(a.data[t])){a.data[t]=[];continue}if(typeof a.data[t]=="object"&&a.data[t]!==null){a.data[t]={};continue}a.data[t]=null}}});return a},l.firestoreList=(e={})=>{e={collection:null,params:{limit:5,startAfter:null},responseParse:t=>t,...e};const a=u({busy:!1,collection:e.collection,startAfter:null,params:e.params,data:[],error:null,submit(){return new Promise(async(t,s)=>{a.busy=!0,setTimeout(async()=>{try{const r=b();let o=[L(r,e.collection),P("updatedAt","desc"),A(a.params.limit)];a.params.startAfter&&o.push(v(a.params.startAfter));const c=T.apply(null,o),d=await k(c),y=d.docs[d.docs.length-1]||null;a.startAfter=y?y.id:null;const m=d.docs.map(g=>({id:g.id,...g.data()}));a.params.startAfter?m.map(g=>{a.data.push(e.responseParse(g))}):a.data=m.map(g=>e.responseParse(g))}catch(r){s(a.error=r.message)}a.busy=!1},100)})}});return a},l.firestoreFind=(e={})=>{e={collection:null,params:{where:"id",value:null},responseParse:t=>t,...e};const a=u({...e,busy:!1,data:!1,error:null,async find(t,s="id"){a.params.where=s,a.params.value=t,a.submit()},submit(){return new Promise(async(t,s)=>{a.busy=!0,setTimeout(async()=>{try{const r=b(),n=L(r,e.collection);let o=[n,P("updatedAt","desc"),A(a.params.limit)];const c=T(n,S(a.params.where,"==",a.params.value)),d=await k(c);d.docs[0]&&(a.data=d.docs[0].data())}catch(r){s(a.error=r.message)}a.busy=!1},100)})}});return a},l},O=()=>{const l={id:null,name:null,sku:null,thumbnail:null,active:null},i=M();let e={};return e.list=i.firestoreList({collection:"product",responseParse(a){return a.id=a.id??null,a.name=a.name??null,a.slug=a.slug??null,a.sku=a.sku??null,a.thumbnail=a.thumbnail??null,a.active=a.active??null,a}}),e.find=i.firestoreFind({collection:"product"}),e.save=i.firestoreFind({collection:"product",data:l,thumbnail:i.storageUpload({onSuccess(a){console.log(a)}})}),e};export{O as u};
