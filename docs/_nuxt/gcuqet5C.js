import{u as W}from"./C493PUJe.js";import{q as R,h as T,n as k,o as V,c as A,b as f,s as P,u as o,v as N,w as v,d as K,x as E,a as w,t as I,r as Z,y as L,z as G,A as Q}from"./8BP2d5Us.js";import{_ as B}from"./DL_i-Lo_.js";import{u as q,a as X}from"./DqHd2ARu.js";import{_ as Y}from"./DogxwKVJ.js";const F=()=>({numberToMoney(s){return new Intl.NumberFormat(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}).format(s)},moneyToNumber(s){return s=s.replace(".",""),s=s.replace(",","."),s=parseFloat(s||"0"),s},stringSlugify(s){return s=(s||"").toLowerCase().trim(),s=s.normalize("NFD").replace(/[\u0300-\u036f]/g,""),s=s.replace(/[^a-z0-9\s-]/g," ").trim(),s=s.replace(/[\s-]+/g,"-"),s}}),H=(s={})=>{let t={};return t.list=W({...s,method:"post",url:"dimona://api/backend/products/filtered",params:{page:1},data:{search:null,categories:[],collections:[],colors:[],sizes:[],customizable:"only",order_by:"sales",per_page:100},response:{data:[]},responseParse(e){return e.data=e.data.map(n=>(n.dimonaUrl=`https://camisadimona.com.br/produto/${n.slug}/`,n)),e}}),t.find=W({...s,method:"get",response:!1,find(e){e&&(t.find.url=`dimona://api/backend/products/${e}`,setTimeout(()=>{t.find.submit()},1e3))},beforeSubmit(){t.find.response=!1}}),t},ee={class:"mb-5"},te={class:"text-center font-weight-bold bg-success py-5"},se={__name:"product-select",props:{modelValue:{type:[Number,Object],default:null}},emits:["update:modelValue","update:attributes"],setup(s,{emit:t}){const e=s,n=F(),a=t,l=H();l.find.on("success",u=>{l.list.response.data=[u.data]});const i=u=>{a("update:modelValue",u),l.find.find(u)},r=R({t:null,handler(u){u&&(r.t&&clearTimeout(r.t),r.t=setTimeout(()=>{l.list.data.search=u,l.list.submit()},1e3))}});return T(()=>e.modelValue,u=>{l.find.response=!1,l.find.find(u)}),(u,m)=>{const h=k("v-autocomplete"),c=k("v-card-text"),_=k("v-card"),g=k("v-expansion-panel-text"),y=k("v-expansion-panel"),d=k("v-expansion-panels"),p=k("v-btn"),b=k("v-card-actions");return V(),A("div",ee,[f(h,P(u.$attrs,{items:o(l).list.response.data,loading:o(l).list.busy||o(l).find.busy,"item-value":"slug","item-title":"name","model-value":e.modelValue,"hide-details":"","onUpdate:modelValue":i,"onUpdate:search":o(r).handler}),null,16,["items","loading","model-value","onUpdate:search"]),o(l).find.busy?(V(),N(_,{key:0},{default:v(()=>[f(c,{class:"text-center"},{default:v(()=>[K("Carregando")]),_:1})]),_:1})):E("",!0),!o(l).find.busy&&o(l).find.response?(V(),N(_,{key:1,loading:o(l).find.busy},{default:v(()=>[w("div",te," PreÃ§o Dimona: R$ "+I(o(n).numberToMoney(o(l).find.response.price)),1),f(d,{variant:"accordion"},{default:v(()=>[f(y,{title:`Cores (${o(l).find.response.colors.length})`},{default:v(()=>[f(g,null,{default:v(()=>[w("pre",null,I(o(l).find.response.colors),1)]),_:1})]),_:1},8,["title"]),f(y,{title:`Tamanhos (${o(l).find.response.sizes.length})`},{default:v(()=>[f(g,null,{default:v(()=>[w("pre",null,I(o(l).find.response.sizes),1)]),_:1})]),_:1},8,["title"])]),_:1}),f(b,{class:"justify-end"},{default:v(()=>[f(p,{text:"Adicionar todos os atributos",class:"bg-primary",onClick:m[0]||(m[0]=()=>{a("update:attributes",{colors:o(l).find.response.colors,sizes:o(l).find.response.sizes})})})]),_:1})]),_:1},8,["loading"])):E("",!0)])}}};var ne=Object.defineProperty,ae=(s,t,e)=>t in s?ne(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,C=(s,t,e)=>ae(s,typeof t!="symbol"?t+"":t,e);const j={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},D=(s,t,e)=>s.replaceAll(t,"").replace(e,".").replace("..",".").replace(/[^.\d]/g,""),O=(s,t,e)=>{var n;return new Intl.NumberFormat(((n=e.number)==null?void 0:n.locale)??"en",{minimumFractionDigits:s,maximumFractionDigits:t,roundingMode:"trunc"})},oe=(s,t=!0,e)=>{var n,a,l,i;const r=((n=e.number)==null?void 0:n.unsigned)==null&&s.startsWith("-")?"-":"",u=((a=e.number)==null?void 0:a.fraction)??0;let m=O(0,u,e);const h=m.formatToParts(1000.12),c=((l=h.find(p=>p.type==="group"))==null?void 0:l.value)??" ",_=((i=h.find(p=>p.type==="decimal"))==null?void 0:i.value)??".",g=D(s,c,_);if(Number.isNaN(parseFloat(g)))return r;const y=g.split(".");if(y[1]!=null&&y[1].length>=1){const p=y[1].length<=u?y[1].length:u;m=O(p,u,e)}let d=m.format(parseFloat(g));return t?u>0&&g.endsWith(".")&&!g.slice(0,-1).includes(".")&&(d+=_):d=D(d,c,_),r+d};class le{constructor(t={}){C(this,"opts",{}),C(this,"memo",new Map);const e={...t};if(e.tokens!=null){e.tokens=e.tokensReplace?{...e.tokens}:{...j,...e.tokens};for(const n of Object.values(e.tokens))typeof n.pattern=="string"&&(n.pattern=new RegExp(n.pattern))}else e.tokens=j;Array.isArray(e.mask)&&(e.mask.length>1?e.mask=[...e.mask].sort((n,a)=>n.length-a.length):e.mask=e.mask[0]??""),e.mask===""&&(e.mask=null),this.opts=e}masked(t){return this.process(t,this.findMask(t))}unmasked(t){return this.process(t,this.findMask(t),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(t){const e=this.findMask(t);if(this.opts.mask==null||e==null)return!1;const n=this.process(t,e).length;return typeof this.opts.mask=="string"?n>=this.opts.mask.length:n>=e.length}findMask(t){const e=this.opts.mask;if(e==null)return null;if(typeof e=="string")return e;if(typeof e=="function")return e(t);const n=this.process(t,e.slice(-1).pop()??"",!1);return e.find(a=>this.process(t,a,!1).length>=n.length)??""}escapeMask(t){const e=[],n=[];return t.split("").forEach((a,l)=>{a==="!"&&t[l-1]!=="!"?n.push(l-n.length):e.push(a)}),{mask:e.join(""),escaped:n}}process(t,e,n=!0){if(this.opts.number!=null)return oe(t,n,this.opts);if(e==null)return t;const a=`v=${t},mr=${e},m=${n?1:0}`;if(this.memo.has(a))return this.memo.get(a);const{mask:l,escaped:i}=this.escapeMask(e),r=[],u=this.opts.tokens!=null?this.opts.tokens:{},m=this.isReversed()?-1:1,h=this.isReversed()?"unshift":"push",c=this.isReversed()?0:l.length-1,_=this.isReversed()?()=>p>-1&&b>-1:()=>p<l.length&&b<t.length,g=M=>!this.isReversed()&&M<=c||this.isReversed()&&M>=c;let y,d=-1,p=this.isReversed()?l.length-1:0,b=this.isReversed()?t.length-1:0,S=!1;for(;_();){const M=l.charAt(p),x=u[M],U=(x==null?void 0:x.transform)!=null?x.transform(t.charAt(b)):t.charAt(b);if(!i.includes(p)&&x!=null?(U.match(x.pattern)!=null?(r[h](U),x.repeated?(d===-1?d=p:p===c&&p!==d&&(p=d-m),c===d&&(p-=m)):x.multiple&&(S=!0,p-=m),p+=m):x.multiple?S&&(p+=m,b-=m,S=!1):U===y?y=void 0:x.optional&&(p+=m,b-=m),b+=m):(n&&!this.isEager()&&r[h](M),U===M&&!this.isEager()?b+=m:y=M,this.isEager()||(p+=m)),this.isEager())for(;g(p)&&(u[l.charAt(p)]==null||i.includes(p));){if(n){if(r[h](l.charAt(p)),t.charAt(b)===l.charAt(p)){p+=m,b+=m;continue}}else l.charAt(p)===t.charAt(b)&&(b+=m);p+=m}}return this.memo.set(a,r.join("")),this.memo.get(a)}}const J=s=>JSON.parse(s.replaceAll("'",'"')),ie=(s,t={})=>{const e={...t};s.dataset.maska!=null&&s.dataset.maska!==""&&(e.mask=re(s.dataset.maska)),s.dataset.maskaEager!=null&&(e.eager=$(s.dataset.maskaEager)),s.dataset.maskaReversed!=null&&(e.reversed=$(s.dataset.maskaReversed)),s.dataset.maskaTokensReplace!=null&&(e.tokensReplace=$(s.dataset.maskaTokensReplace)),s.dataset.maskaTokens!=null&&(e.tokens=ue(s.dataset.maskaTokens));const n={};return s.dataset.maskaNumberLocale!=null&&(n.locale=s.dataset.maskaNumberLocale),s.dataset.maskaNumberFraction!=null&&(n.fraction=parseInt(s.dataset.maskaNumberFraction)),s.dataset.maskaNumberUnsigned!=null&&(n.unsigned=$(s.dataset.maskaNumberUnsigned)),(s.dataset.maskaNumber!=null||Object.values(n).length>0)&&(e.number=n),e},$=s=>s!==""?!!JSON.parse(s):!0,re=s=>s.startsWith("[")&&s.endsWith("]")?J(s):s,ue=s=>{if(s.startsWith("{")&&s.endsWith("}"))return J(s);const t={};return s.split("|").forEach(e=>{const n=e.split(":");t[n[0]]={pattern:new RegExp(n[1]),optional:n[2]==="optional",multiple:n[2]==="multiple",repeated:n[2]==="repeated"}}),t};class de{constructor(t,e={}){C(this,"items",new Map),C(this,"onInput",n=>{if(n instanceof CustomEvent&&n.type==="input"&&!n.isTrusted)return;const a=n.target,l=this.items.get(a),i="inputType"in n&&n.inputType.startsWith("delete"),r=l.isEager(),u=i&&r&&l.unmasked(a.value)===""?"":a.value;this.fixCursor(a,i,()=>this.setValue(a,u))}),this.options=e,this.init(this.getInputs(t))}update(t={}){this.options={...t},this.init(Array.from(this.items.keys()))}updateValue(t){t.value!==""&&t.value!==this.processInput(t).masked&&this.setValue(t,t.value)}destroy(){for(const t of this.items.keys())t.removeEventListener("input",this.onInput);this.items.clear()}init(t){const e=this.getOptions(this.options);for(const n of t){this.items.has(n)||n.addEventListener("input",this.onInput,{capture:!0});const a=new le(ie(n,e));this.items.set(n,a),queueMicrotask(()=>this.updateValue(n)),n.selectionStart===null&&a.isEager()&&console.warn("Maska: input of `%s` type is not supported",n.type)}}getInputs(t){return typeof t=="string"?Array.from(document.querySelectorAll(t)):"length"in t?Array.from(t):[t]}getOptions(t){const{onMaska:e,preProcess:n,postProcess:a,...l}=t;return l}fixCursor(t,e,n){const a=t.selectionStart,l=t.value;if(n(),a===null||a===l.length&&!e)return;const i=t.value,r=l.slice(0,a),u=i.slice(0,a),m=this.processInput(t,r).unmasked,h=this.processInput(t,u).unmasked;let c=a;r!==u&&(c+=e?i.length-l.length:m.length-h.length),t.setSelectionRange(c,c)}setValue(t,e){const n=this.processInput(t,e);t.value=n.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(a=>a(n)):this.options.onMaska(n)),t.dispatchEvent(new CustomEvent("maska",{detail:n})),t.dispatchEvent(new CustomEvent("input",{detail:n.masked}))}processInput(t,e){const n=this.items.get(t);let a=e??t.value;this.options.preProcess!=null&&(a=this.options.preProcess(a));let l=n.masked(a);return this.options.postProcess!=null&&(l=this.options.postProcess(l)),{masked:l,unmasked:n.unmasked(a),completed:n.completed(a)}}}const z=new WeakMap,me=(s,t)=>{if(s.arg==null||s.instance==null)return;const e="setup"in s.instance.$.type;s.arg in s.instance?s.instance[s.arg]=t:e&&console.warn("Maska: please expose `%s` using defineExpose",s.arg)},pe=(s,t)=>{var e;const n=s instanceof HTMLInputElement?s:s.querySelector("input");if(n==null||(n==null?void 0:n.type)==="file")return;let a={};if(t.value!=null&&(a=typeof t.value=="string"?{mask:t.value}:{...t.value}),t.arg!=null){const l=i=>{const r=t.modifiers.unmasked?i.unmasked:t.modifiers.completed?i.completed:i.masked;me(t,r)};a.onMaska=a.onMaska==null?l:Array.isArray(a.onMaska)?[...a.onMaska,l]:[a.onMaska,l]}z.has(n)?(e=z.get(n))==null||e.update(a):z.set(n,new de(n,a))},ce={__name:"money",props:{modelValue:{type:[Number],default:""}},emits:["update:modelValue"],setup(s,{emit:t}){const e=F(),n=s,a=t,l=Z(null),i=R({number:0,string:""});return i.number=n.modelValue||0,i.string=e.numberToMoney(i.number),T(()=>n.modelValue,r=>{document.activeElement==l.value.$el||l.value.$el.contains(document.activeElement)||(i.number=r||0,i.string=e.numberToMoney(i.number))}),(r,u)=>{const m=k("v-text-field");return L((V(),N(m,P(r.$attrs,{ref_key:"inputRef",ref:l,modelValue:o(i).string,"onUpdate:modelValue":[u[0]||(u[0]=h=>o(i).string=h),u[1]||(u[1]=h=>{o(i).number=o(e).moneyToNumber(h),a("update:modelValue",o(i).number)})],onFocus:u[2]||(u[2]=h=>h.target.select())}),null,16,["modelValue"])),[[o(pe),{mask:"9.99#,##",reversed:!0,tokens:{9:{pattern:/[0-9]/,repeated:!0}}}]])}}},fe={class:"mb-5"},he=["onUpdate:modelValue"],ve={key:1},ke={key:2},_e=["src"],ge={__name:"attributes-edit",props:{modelValue:{type:[Array],default:()=>[]},type:{type:[String],default:null}},emits:["update:modelValue"],setup(s,{emit:t}){const e=s,n=t,a={colors:{id:null,name:null,hexadecimal:null},sizes:{id:null,name:null},prints:{id:null,name:null,url:null}},{storageUpload:l}=q(),i=R({items:[],add(r={}){i.items.push(i.defaults(r)),n("update:modelValue",i.items)},remove(r){const u=i.items.indexOf(r);i.items.splice(u,1),n("update:modelValue",i.items)},set(r){i.items=e.modelValue.map(u=>i.defaults(u))},defaults(r){return typeof a[e.type]<"u"?{...a[e.type],...r}:r}});return i.set(e.modelValue),T(()=>e.modelValue,r=>{i.set(r)}),(r,u)=>{const m=k("v-btn"),h=B;return V(),A("div",fe,[f(h,{headers:[{field:"name",name:"Nome"},{field:"value",name:"Valor",width:"150px"}],items:o(i).items,actions:c=>[{text:"Upload",icon:"mdi-upload",showIf(){return e.type=="prints"},onClick(){o(l)({onSuccess(g){c.item.url=g.url,n("update:modelValue",o(i).items)}}).browse()}},{text:"Deletar",icon:"mdi-delete",onClick(){o(i).remove(c.item)}}]},{"item:name":v(c=>[L(w("input",{type:"text","onUpdate:modelValue":_=>c.item.name=_,class:"w-100 pa-3",placeholder:"Nome",onInput:u[0]||(u[0]=()=>{n("update:modelValue",o(i).items)})},null,40,he),[[G,c.item.name]])]),"item:value":v(c=>[e.type=="colors"?(V(),N(m,{key:0,color:c.item.hexadecimal,block:""},null,8,["color"])):E("",!0),e.type=="sizes"?(V(),A("div",ve)):E("",!0),e.type=="prints"?(V(),A("div",ke,[c.item.url?(V(),A("img",{key:0,src:c.item.url,alt:"",style:{width:"100%",height:"100px","object-fit":"contain"}},null,8,_e)):E("",!0)])):E("",!0)]),_:1},8,["items","actions"]),f(m,{block:"",text:"Add",color:"primary",onClick:u[1]||(u[1]=c=>o(i).add())})])}}},be=["src"],ye={__name:"firebase-upload",props:{modelValue:{type:[String],default:""}},emits:["update:modelValue"],setup(s,{emit:t}){const{storageUpload:e}=q(),n=e({onSuccess(r){i.url=r.url,l("update:modelValue",r.url)}}),a=s,l=t,i=R({url:a.modelValue,isImage(){if(this.url){const r=new URL(this.url);if(r.pathname&&(r.pathname.endsWith(".jpg")||r.pathname.endsWith(".jpeg")||r.pathname.endsWith(".gif")||r.pathname.endsWith(".bmp")||r.pathname.endsWith(".png")||r.pathname.endsWith(".webp")))return!0}return!1}});return T(()=>a.modelValue,r=>{i.url=r}),(r,u)=>{const m=k("v-expand-transition"),h=k("v-text-field"),c=k("v-card");return V(),N(c,null,{default:v(()=>[f(m,null,{default:v(()=>[o(i).isImage()?(V(),A("img",{key:0,src:o(i).url,alt:"",style:{width:"100%","margin-bottom":"-4px"}},null,8,be)):E("",!0)]),_:1}),f(h,P({modelValue:o(i).url,"onUpdate:modelValue":u[0]||(u[0]=_=>o(i).url=_),readonly:"","hide-details":""},r.$attrs,{"prepend-icon":null,"append-inner-icon":o(i).url?"mdi-delete":"mdi-upload","onClick:appendInner":u[1]||(u[1]=()=>{if(o(i).url){o(i).url=null,l("update:modelValue",null);return}o(n).browse()})}),null,16,["modelValue","append-inner-icon"])]),_:1})}}},Ve=w("br",null,null,-1),xe={class:"d-flex justify-end ga-3"},we=w("br",null,null,-1),Me={class:"d-flex justify-end ga-3"},Ce={__name:"product",setup(s){const t=F();H();const e=X();return Q(()=>{e.list.submit()}),(n,a)=>{const l=se,i=k("v-text-field"),r=ce,u=ge,m=ye,h=k("v-btn"),c=k("v-col"),_=B,g=k("v-row"),y=Y;return V(),N(y,{name:"admin"},{default:v(()=>[w("div",null,[f(g,null,{default:v(()=>[f(c,{cols:"6"},{default:v(()=>[f(l,{label:"Referencia produto Dimona",modelValue:o(e).save.data.dimonaProductSlug,"onUpdate:modelValue":a[0]||(a[0]=d=>o(e).save.data.dimonaProductSlug=d),"onUpdate:attributes":a[1]||(a[1]=d=>{o(e).save.data.sizes=d.sizes,o(e).save.data.colors=d.colors})},null,8,["modelValue"]),f(i,{label:"Nome",modelValue:o(e).save.data.name,"onUpdate:modelValue":a[2]||(a[2]=d=>o(e).save.data.name=d)},null,8,["modelValue"]),f(i,{label:"SKU",modelValue:o(e).save.data.sku,"onUpdate:modelValue":a[3]||(a[3]=d=>o(e).save.data.sku=d),"append-inner-icon":"zondicons:bookmark-copy-2","onClick:appendInner":a[4]||(a[4]=()=>{o(e).save.data.sku=o(t).stringSlugify(o(e).save.data.name)})},null,8,["modelValue"]),f(r,{label:"Valor",modelValue:o(e).save.data.amount,"onUpdate:modelValue":a[5]||(a[5]=d=>o(e).save.data.amount=d)},null,8,["modelValue"]),f(u,{label:"Cores",type:"colors",modelValue:o(e).save.data.colors,"onUpdate:modelValue":a[6]||(a[6]=d=>o(e).save.data.colors=d)},null,8,["modelValue"]),f(u,{label:"Tamanhos",type:"sizes",modelValue:o(e).save.data.sizes,"onUpdate:modelValue":a[7]||(a[7]=d=>o(e).save.data.sizes=d)},null,8,["modelValue"]),f(u,{label:"Estampas",type:"prints",modelValue:o(e).save.data.prints,"onUpdate:modelValue":a[8]||(a[8]=d=>o(e).save.data.prints=d)},null,8,["modelValue"]),f(m,{label:"Thumbnail",modelValue:o(e).save.data.thumbnail,"onUpdate:modelValue":a[9]||(a[9]=d=>o(e).save.data.thumbnail=d)},null,8,["modelValue"]),Ve,w("div",xe,[f(h,{text:"Limpar",onClick:a[10]||(a[10]=async()=>{o(e).save.dataClear()})}),f(h,{text:"Salvar",color:"success",loading:o(e).save.busy,onClick:a[11]||(a[11]=async()=>{await o(e).save.submit(),await o(e).list.submit(),await o(e).save.dataClear()})},null,8,["loading"])])]),_:1}),f(c,{cols:"6"},{default:v(()=>[f(_,{items:o(e).list.data,headers:[{name:"Nome",field:"name"},{name:"SKU",field:"sku",width:"200px"}],actions:d=>[{text:"Edit",color:"primary",icon:"mdi-pen",onClick(){o(e).save.data={...d.item}}},{text:"Delete",icon:"mdi-delete",color:"error",async onClick(){await o(e).delete.delete(d.item),await o(e).list.submit()}}]},null,8,["items","actions"]),we,w("div",Me,[f(h,{text:"Buscar",loading:o(e).list.busy,onClick:a[12]||(a[12]=async()=>{await o(e).list.submit()})},null,8,["loading"])])]),_:1})]),_:1})])]),_:1})}}};export{Ce as default};
