import{u as S}from"./Dxcec0CE.js";import{L as p,M as _,N as R,O as P,P as A,Q as C,R as D,S as U,T as V,U as $,V as N,W as B,X as j,Y as z,Z as E,$ as y,a0 as M,a1 as F,a2 as O,a3 as W,a4 as q,a5 as K,a6 as T,o as I,v,z as c,A as b,x as r,y as w,a7 as o,g as h,t as k,B as Q,a8 as X,a9 as Y}from"./CD0AYaGk.js";const Z=(e={})=>{let u={};return u.list=S({...e,method:"post",url:"dimona://api/backend/products/filtered",params:{page:1},data:{search:null,categories:[],collections:[],colors:[],sizes:[],customizable:"only",order_by:"sales",per_page:100},response:{data:[]},responseParse(a){return a.data=a.data.map(t=>(t.dimonaUrl=`https://camisadimona.com.br/produto/${t.slug}/`,t)),a}}),u},G=()=>{let e={};e.auth=p({busy:!1,ready:!1,user:null,error:null,init(){if(e.auth.ready)return;const a=y();M(a,t=>{t&&(e.auth.ready=!0,t.displayName=t.displayName||t.email,t.photoURL=t.photoURL||`https://api.dicebear.com/9.x/big-smile/svg?seed=${btoa(t.email)}`,e.auth.user=t)})},async logout(){e.auth.busy=!0;try{const a=y();await F(a),e.auth.user=null}catch(a){e.auth.error=a.message}e.auth.busy=!1}}),e.auth.init(),e.authCreate=p({busy:!1,data:{email:"",password:""},error:null,async submit(){e.authCreate.error=null,e.authCreate.busy=!0;try{const a=y(),t=await O(a,e.authCreate.data.email,e.authCreate.data.password);e.authCreate.data.email="",e.authCreate.data.password=""}catch(a){e.authCreate.error=a.message}e.authCreate.busy=!1}}),e.authLogin=p({busy:!1,data:{email:"",password:""},error:null,async submit(){e.authLogin.error=null,e.authLogin.busy=!0;try{const a=y(),t=await W(a,e.authLogin.data.email,e.authLogin.data.password);e.authLogin.data.email="",e.authLogin.data.password=""}catch(a){e.authLogin.error=a.message}e.authLogin.busy=!1}}),e.userList=p({busy:!1,params:{perPage:50,nextPage:null},error:null,async submit(){e.userList.busy=!0;const t=await y().listUsers(e.userList.perPage,e.userList.nextPage);console.log(t),e.userList.busy=!1}});const u=async a=>{const t=await q(a);return{url:await K(a),name:t.name,mime:t.contentType,size:t.size}};return e.storageUpload=(a={})=>{a={onSuccess:s=>null,...a};const t=p({busy:!1,lastUploads:[],async browse(){Object.assign(document.createElement("input"),{type:"file",onchange(s){s.target.files[0]&&t.submit(s.target.files[0])}}).click()},async submit(s){t.busy=!0;const n=_(),l=await R(P(n,s.name),s),d=await u(l.ref);return a.onSuccess(d),t.lastUploads.push(d),t.busy=!1,d},...a});return t},e.storageList=p({busy:!1,params:{maxResults:50},pages:0,data:[],async submit(a={}){if(a={firstPage:!1,...a},!a.firstPage&&e.storageList.pages>0&&!e.storageList.params.pageToken)return;e.storageList.busy=!0;const t=_(),s=P(t);a.firstPage&&(e.storageList.pages=0,e.storageList.params.pageToken=null,e.storageList.data=[]);const n=await T(s,e.storageList.params);await Promise.all(n.items.map(async l=>{e.storageList.data.push(await u(l))})),n.nextPageToken&&e.storageList.pages++,e.storageList.params.pageToken=n.nextPageToken||!1,e.storageList.busy=!1},async loadMore(){if(!e.storageList.nextPageToken)return;const a=_(),t=P(a);e.storageList.busy=!0;const s=await T(t,{...e.storageList.params,pageToken:e.storageList.nextPageToken});await Promise.all(s.items.map(async n=>{e.storageList.data.push(await u(n))})),e.storageList.nextPageToken=s.nextPageToken||!1,e.storageList.busy=!1}}),e.firestoreSave=(a={})=>{a={collection:null,data:{},...a};const t=p({busy:!1,...a,error:null,submit(){return new Promise(async(s,n)=>{t.busy=!0;try{const l=A(),d=C(l,a.collection);if(t.data.id){const m=await D(l,a.collection,t.data.id);t.data.updatedAt=U().format();const f=await V(m,t.data);s(f)}else{t.data.createdAt=t.data.updatedAt=U().format();const m=await $(d,t.data);t.data.id=m.id,s(m),t.submit()}}catch(l){n(t.error=l.message)}t.busy=!1})},async dataClear(){for(let s in t.data){if(Array.isArray(t.data[s])){t.data[s]=[];continue}if(typeof t.data[s]=="object"&&t.data[s]!==null){t.data[s]={};continue}t.data[s]=null}}});return t},e.firestoreList=(a={})=>{a={collection:null,params:{limit:5,startAfter:null},responseParse:s=>s,...a};const t=p({busy:!1,collection:a.collection,startAfter:null,params:a.params,data:[],error:null,submit(){return new Promise(async(s,n)=>{t.busy=!0,setTimeout(async()=>{try{const l=A();let m=[C(l,a.collection),N("updatedAt","desc"),B(t.params.limit)];t.params.startAfter&&m.push(j(t.params.startAfter));const f=z.apply(null,m),i=await E(f),L=i.docs[i.docs.length-1]||null;t.startAfter=L?L.id:null;const x=i.docs.map(g=>({id:g.id,...g.data()}));t.params.startAfter?x.map(g=>{t.data.push(a.responseParse(g))}):t.data=x.map(g=>a.responseParse(g))}catch(l){n(t.error=l.message)}t.busy=!1},100)})}});return t},e},H=()=>{const e=G();let u={};return u.list=e.firestoreList({collection:"product",responseParse(a){return a.id=a.id??null,a.name=a.name??null,a.sku=a.sku??null,a.thumbnail=a.thumbnail??null,a}}),u.save=e.firestoreSave({collection:"product",data:{id:null,name:null,sku:null,thumbnail:null},thumbnail:e.storageUpload({onSuccess(a){console.log(a)}})}),u},J={class:"pa-3"},aa=r("br",null,null,-1),ta={class:"d-flex justify-end ga-3"},ea=r("colgroup",null,[r("col",{width:"*"}),r("col",{width:"150px"}),r("col",{width:"50px"})],-1),sa=r("thead",null,[r("tr",null,[r("th",null,"Nome"),r("th",null,"SKU"),r("th")])],-1),ra={class:"pa-0"},la=r("br",null,null,-1),oa={class:"d-flex justify-end ga-3"},ia={__name:"products",setup(e){const u=Z(),a=H();return I(()=>{a.list.submit()}),(t,s)=>{const n=h("v-text-field"),l=h("v-btn"),d=h("v-col"),m=h("v-table"),f=h("v-row");return k(),v("div",J,[c(f,null,{default:b(()=>[c(d,{cols:"6"},{default:b(()=>[c(n,{label:"Nome",modelValue:o(a).save.data.name,"onUpdate:modelValue":s[0]||(s[0]=i=>o(a).save.data.name=i)},null,8,["modelValue"]),c(n,{label:"SKU",modelValue:o(a).save.data.sku,"onUpdate:modelValue":s[1]||(s[1]=i=>o(a).save.data.sku=i)},null,8,["modelValue"]),c(l,{block:"",onClick:s[2]||(s[2]=i=>o(a).save.thumbnail.browse())},{default:b(()=>[Q("Upload")]),_:1}),aa,r("div",ta,[c(l,{text:"Limpar",onClick:s[3]||(s[3]=async()=>{o(a).save.dataClear()})}),c(l,{text:"Salvar",color:"success",loading:o(a).save.busy,onClick:s[4]||(s[4]=async()=>{await o(a).save.submit(),await o(a).list.submit(),await o(a).save.dataClear()})},null,8,["loading"])])]),_:1}),c(d,{cols:"6"},{default:b(()=>[c(m,{class:"border"},{default:b(()=>[ea,sa,r("tbody",null,[(k(!0),v(X,null,Y(o(a).list.data,i=>(k(),v("tr",null,[r("td",null,w(i.name),1),r("td",null,w(i.sku),1),r("td",ra,[c(l,{rounded:"0",flat:"",icon:"mdi-edit",onClick:L=>o(a).save.data={...i}},null,8,["onClick"])])]))),256))])]),_:1}),la,r("div",oa,[c(l,{text:"Buscar",loading:o(a).list.busy,onClick:s[5]||(s[5]=async()=>{await o(a).list.submit()})},null,8,["loading"])])]),_:1})]),_:1}),r("pre",null,"appProduct: "+w(o(a)),1),r("pre",null,"dimonaProduct: "+w(o(u)),1)])}}};export{ia as default};
