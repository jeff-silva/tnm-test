import{q as u,I as p,J as v,K as y,L as f,M as h,N as w,O as P,P as C,Q as R,R as A,S as T,T as U,U as k,V as D,W as S,X as $,Y as g,Z as q,$ as F,a0 as _,a1 as j,a2 as z,a3 as E,a4 as x}from"./Qx7K5HX-.js";const M=()=>{let o={};o.auth=(e={})=>{const a=u({busy:!1,ready:!1,user:null,error:null,init(){if(a.auth.ready)return;const t=g();q(t,s=>{s&&(a.auth.ready=!0,s.displayName=s.displayName||s.email,s.photoURL=s.photoURL||`https://api.dicebear.com/9.x/big-smile/svg?seed=${btoa(s.email)}`,a.auth.user=s)})},async logout(){a.auth.busy=!0;try{const t=g();await F(t),a.auth.user=null}catch(t){a.auth.error=t.message}a.auth.busy=!1}});return a.init(),a},o.authCreate=(e={})=>{const a=u({busy:!1,data:{email:"",password:""},error:null,async submit(){a.authCreate.error=null,a.authCreate.busy=!0;try{const t=g(),s=await _(t,a.authCreate.data.email,a.authCreate.data.password);a.authCreate.data.email="",a.authCreate.data.password=""}catch(t){a.authCreate.error=t.message}a.authCreate.busy=!1}});return a},o.authLogin=(e={})=>{const a=u({busy:!1,data:{email:"",password:""},error:null,async submit(){a.authLogin.error=null,a.authLogin.busy=!0;try{const t=g(),s=await j(t,a.authLogin.data.email,a.authLogin.data.password);a.authLogin.data.email="",a.authLogin.data.password=""}catch(t){a.authLogin.error=t.message}a.authLogin.busy=!1}});return a},o.userList=(e={})=>{const a=u({busy:!1,params:{perPage:50,nextPage:null},error:null,async submit(){a.userList.busy=!0;const s=await g().listUsers(a.userList.perPage,a.userList.nextPage);console.log(s),a.userList.busy=!1}});return a};const c=async e=>{const a=await z(e);return{url:await E(e),name:a.name,mime:a.contentType,size:a.size}};return o.storageUpload=(e={})=>{e={onSuccess:t=>null,...e};const a=u({...e,busy:!1,lastUploads:[],async browse(){Object.assign(document.createElement("input"),{type:"file",onchange(t){t.target.files[0]&&a.submit(t.target.files[0])}}).click()},submit(t){return new Promise(async(s,r)=>{a.busy=!0;const n=p(),l=await v(y(n,t.name),t),i=await c(l.ref);a.onSuccess(i),a.lastUploads.push(i),s(i),a.busy=!1})},...e});return a},o.storageList=(e={})=>{const a=u({busy:!1,params:{maxResults:50},pages:0,data:[],async submit(t={}){if(t={firstPage:!1,...t},!t.firstPage&&a.storageList.pages>0&&!a.storageList.params.pageToken)return;a.storageList.busy=!0;const s=p(),r=y(s);t.firstPage&&(a.storageList.pages=0,a.storageList.params.pageToken=null,a.storageList.data=[]);const n=await x(r,a.storageList.params);await Promise.all(n.items.map(async l=>{a.storageList.data.push(await c(l))})),n.nextPageToken&&a.storageList.pages++,a.storageList.params.pageToken=n.nextPageToken||!1,a.storageList.busy=!1},async loadMore(){if(!a.storageList.nextPageToken)return;const t=p(),s=y(t);a.storageList.busy=!0;const r=await x(s,{...a.storageList.params,pageToken:a.storageList.nextPageToken});await Promise.all(r.items.map(async n=>{a.storageList.data.push(await c(n))})),a.storageList.nextPageToken=r.nextPageToken||!1,a.storageList.busy=!1}});return a},o.firestoreSave=(e={})=>{e={collection:null,data:{},...e};const a=u({busy:!1,...e,error:null,submit(){return new Promise(async(t,s)=>{a.busy=!0;try{const r=f(),n=h(r,e.collection);if(a.data.id){const l=await w(r,e.collection,a.data.id);a.data.updatedAt=P().format();const i=await C(l,a.data);t(i)}else{a.data.createdAt=a.data.updatedAt=P().format();const l=await R(n,a.data);a.data.id=l.id,t(l),a.submit()}}catch(r){s(a.error=r.message)}a.busy=!1})},async dataClear(){for(let t in a.data){if(Array.isArray(a.data[t])){a.data[t]=[];continue}if(typeof a.data[t]=="object"&&a.data[t]!==null){a.data[t]={};continue}a.data[t]=null}}});return a},o.firestoreList=(e={})=>{e={collection:null,params:{limit:20,startAfter:null},responseParse:t=>t,...e};const a=u({busy:!1,collection:e.collection,startAfter:null,params:e.params,data:[],error:null,submit(){return new Promise(async(t,s)=>{a.busy=!0,setTimeout(async()=>{try{const r=f();let l=[h(r,e.collection),A("updatedAt","desc"),T(a.params.limit)];a.params.startAfter&&l.push(U(a.params.startAfter));const i=k.apply(null,l),d=await D(i),b=d.docs[d.docs.length-1]||null;a.startAfter=b?b.id:null;const L=d.docs.map(m=>({id:m.id,...m.data()}));a.params.startAfter?L.map(m=>{a.data.push(e.responseParse(m))}):a.data=L.map(m=>e.responseParse(m))}catch(r){s(a.error=r.message)}a.busy=!1},100)})}});return a},o.firestoreFind=(e={})=>{e={collection:null,params:{where:"id",value:null},responseParse:t=>t,...e};const a=u({...e,busy:!1,data:!1,error:null,async find(t,s="id"){a.params.where=s,a.params.value=t,a.submit()},submit(){return new Promise(async(t,s)=>{a.busy=!0,setTimeout(async()=>{try{const r=f(),n=h(r,e.collection);let l=[n,A("updatedAt","desc"),T(a.params.limit)];const i=k(n,S(a.params.where,"==",a.params.value)),d=await D(i);d.docs[0]&&(a.data=d.docs[0].data())}catch(r){s(a.error=r.message)}a.busy=!1},100)})}});return a},o.firestoreDelete=(e={})=>{e={collection:null,...e};const a=u({...e,async delete(t){const s=f();return await $(w(s,a.collection,t.id))},async submit(){}});return a},o},O=()=>{const o={id:null,name:null,sku:null,thumbnail:null,active:null},c=M();let e={};return e.list=c.firestoreList({collection:"shop_product",responseParse(a){return a.id=a.id??null,a.name=a.name??null,a.sku=a.sku??null,a.thumbnail=a.thumbnail??null,a.amount=a.amount??0,a.active=a.active??null,a.dimonaProductSlug=a.dimonaProductSlug??null,a.colors=a.colors??[],a.sizes=a.sizes??[],a.prints=a.prints??[],a}}),e.find=c.firestoreFind({collection:"shop_product"}),e.save=c.firestoreSave({collection:"shop_product",data:o}),e.delete=c.firestoreDelete({collection:"shop_product"}),e};export{O as a,M as u};
